{% extends "base.html" %}

{% block title %}Social Commerce News{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Stats Row -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-number">{{ article_count }}</div>
                <div class="stat-label">Total Articles</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-number">{{ keyword_count }}</div>
                <div class="stat-label">Tracked Keywords</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-number">{{ active_keyword_count }}</div>
                <div class="stat-label">Active Keywords</div>
            </div>
        </div>
    </div>

    <!-- Featured Article -->
    {% if recent_articles %}
    <div class="featured-article">
        <div class="row">
            <div class="col-md-8">
                <a href="{{ url_for('article_detail', article_id=recent_articles[0].id) }}" class="text-decoration-none text-white">
                    <div class="article-img-container" style="height: 300px;">
                        <img src="{{ recent_articles[0].image_url }}" class="article-img" alt="{{ recent_articles[0].title }}">
                        <div class="article-overlay">
                            <div class="article-title">
                                <h3 class="h3">{{ recent_articles[0].title }}</h3>
                            </div>
                        </div>
                    </div>
                </a>
                <div class="mt-3 mb-3">
                    <span class="badge bg-secondary">{{ recent_articles[0].source }}</span>
                    <span class="ms-2 text-muted">{{ recent_articles[0].published_date.strftime('%b %d, %Y') if recent_articles[0].published_date else 'Unknown date' }}</span>
                </div>
                <div class="mt-3">
                    {% for keyword in recent_articles[0].keywords[:5] %}
                    <span class="badge keyword-badge">{{ keyword.display_name }}</span>
                    {% endfor %}
                </div>

            </div>
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="h5 mb-0">Export Options</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('export_articles', days=7) }}" class="btn btn-outline-light">
                                <i class="bi bi-file-earmark-spreadsheet me-2"></i>Export to CSV
                            </a>
                            <a href="{{ url_for('export_for_chatgpt', days=7) }}" class="btn btn-verge">
                                <i class="bi bi-chat-square-text me-2"></i>Export for ChatGPT
                            </a>
                        </div>
                        <div class="mt-3 small text-muted">
                            Export the last week's articles to create your newsletter
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="h5 mb-0">Quick Actions</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/trends" class="btn btn-outline-light">
                                <i class="bi bi-graph-up me-2"></i>View Trends
                            </a>
                            <a href="/keywords" class="btn btn-outline-light">
                                <i class="bi bi-tags me-2"></i>Manage Keywords
                            </a>
                            <form action="{{ url_for('update_data') }}" method="POST" class="d-grid">
                                <button type="submit" class="btn btn-verge">
                                    <i class="bi bi-arrow-repeat me-2"></i>Collect New Articles
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info">
                <h4 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Welcome to Social Commerce News!</h4>
                <p>No articles have been collected yet. Click the "Collect New Articles" button to start gathering social commerce industry news.</p>
                <hr>
                <form action="{{ url_for('update_data') }}" method="POST">
                    <button type="submit" class="btn btn-verge">
                        <i class="bi bi-arrow-repeat me-2"></i>Collect New Articles
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Latest Articles -->
    <h2 class="section-heading">LATEST STORIES</h2>
    
    <div class="row">
        {% if recent_articles and recent_articles|length > 1 %}
            {% for article in recent_articles[1:7] %}
            <div class="col-md-4 mb-4">
                <div class="article-card">
                    <a href="{{ url_for('article_detail', article_id=article.id) }}" class="text-decoration-none text-white">
                        <div class="article-img-container">
                            <img src="{{ article.image_url }}" class="article-img" alt="{{ article.title }}">
                            <div class="article-overlay">
                                <div class="article-title">
                                    <h3 class="h5">{{ article.title|truncate(60) }}</h3>
                                </div>
                            </div>
                        </div>
                    </a>
                    <div class="source-date mt-2">
                        <div><span class="badge bg-secondary">{{ article.source }}</span></div>
                        <div>{{ article.published_date.strftime('%b %d, %Y') if article.published_date else 'Unknown date' }}</div>
                    </div>
                    <div class="mt-2">
                        {% for keyword in article.keywords[:3] %}
                        <span class="badge keyword-badge">{{ keyword.display_name }}</span>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- Keyword Categories -->
    <h2 class="section-heading">ACTIVE KEYWORDS</h2>
    
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex flex-wrap">
                        {% for keyword in keywords %}
                        <a href="{{ url_for('articles_list', keyword_id=keyword.id) }}" class="badge keyword-badge text-decoration-none me-2 mb-2">{{ keyword.display_name }}</a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- More Articles -->
    {% if recent_articles and recent_articles|length > 7 %}
    <h2 class="section-heading">MORE STORIES</h2>
    
    <div class="row">
        {% for article in recent_articles[7:] %}
        <div class="col-md-3 mb-4">
            <div class="article-card">
                <a href="{{ url_for('article_detail', article_id=article.id) }}" class="text-decoration-none text-white">
                    <div class="article-img-container" style="height: 150px;">
                        <img src="{{ article.image_url }}" class="article-img" alt="{{ article.title }}">
                        <div class="article-overlay">
                            <div class="article-title">
                                <h3 class="h6">{{ article.title|truncate(50) }}</h3>
                            </div>
                        </div>
                    </div>
                </a>
                <div class="source-date mt-2">
                    <div><span class="badge bg-secondary">{{ article.source }}</span></div>
                    <div>{{ article.published_date.strftime('%b %d') if article.published_date else 'Unknown' }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-dismissing alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});
</script>
{% endblock %}